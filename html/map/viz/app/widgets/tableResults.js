define(["table/TableController","widgets/CompanyPopup","react"],function(e,a,t){"use strict";var o=[],r=[],s={},n=React.createClass({displayName:"tableResults",showPopup:function(e,t){document.getElementById("popup-area").style.display="block",document.getElementById("popup-area").style.left=t.target.clientWidth+t.target.offsetLeft+"px",document.getElementById("popup-area").style.top=t.target.offsetTop+"px";var o=e.props.data;s.name=o["Company Name"],s.country=o.Country,s.profileID=o.profileID;var r=[{value:o.Country,label:"Country"},{value:o.City,label:"City"},{value:o["Founding Year"],label:"Founding Year"},{value:o.Size,label:"Size"},{value:o["Organization Type"],label:"Organization Type"},{value:o.URL,label:"URL"},{value:o.Description,label:"Description"},{value:o["Industry Category"],label:"Category"},{value:o["Entry Based On"],label:"Entry Based On"},{value:o["Data Use"],label:"Data Use"}];"1"==o.use_advocacy&&r.push({label:"Application",value:"Advocacy: "+o.use_advocacy_desc}),"1"==o.use_prod_srvc&&r.push({label:"Application",value:"New Products and Services: "+o.use_prod_srvc_desc}),"1"==o.use_org_opt&&r.push({label:"Application",value:"Organizational Optimization: "+o.use_org_opt_desc}),"1"==o.use_research&&r.push({label:"Application",value:"Research: "+o.use_research_desc}),"1"==o.use_other&&r.push({label:"Application",value:"Other: "+o.use_other_desc}),React.render(React.createElement(a,{keys:{profileID:{value:o.profileID},items:r,showContent:!0,title:{label:o["Company Name"],selected:!0,toggle:!1}}}),document.getElementById("company-popup"))},componentDidMount:function(){},hidePopup:function(e,a){document.getElementById("popup-area").style.display="none"},sendToEdit:function(){var e=s.profileID,a="http://odetest.govready.org/map/company/"+e+"/edit";window.open(a,"_blank")},exportTableDataJSON:function(){var e=JSON.stringify(o,null,4),a=new Date,t=a.getDate(),r=a.getMonth()+1,s=a.getFullYear();10>t&&(t="0"+t),10>r&&(r="0"+r);var a=t+"_"+r+"_"+s,n=new Blob([e],{type:"text/plain;charset=utf-8"});fileSaveAs(n,"Open Data Impact Map _ Data Export _ "+a+".txt")},exportTableData:function(){var e=_.map(o,_.clone);delete e[0].profileID,delete e[0].use_advocacy,delete e[0].use_org_opt,delete e[0].use_other,delete e[0].use_prod_srvc,delete e[0].use_research;var a=[];a.push(Object.keys(e[0])),_.forEach(e,function(e){_.forEach(e,function(a,t){e[t]=String(e[t]).replace(/,/g," - "),e[t]=String(e[t]).replace(/(\r\n|\n|\r)/gm," ")}),a.push([e["Company Name"],e.Region,e.Country,e["Organization Type"],e["Industry Category"],e.Description,e["Data Use"],e.City,e["Founding Year"],e.Size,e.URL,e["Entry Based On"],e.use_advocacy_desc,e.use_prod_srvc_desc,e.use_org_opt_desc,e.use_research_desc,e.use_other_desc]),_.forEach(a,function(e,t){_.forEach(e,function(e,o){"null"==e&&(a[t][o]=" ")})})});var t="";a.forEach(function(e,o){var r=e.join(",");t+=o<a.length?r+"\n":r});var r=new Date,s=r.getDate(),n=r.getMonth()+1,l=r.getFullYear();10>s&&(s="0"+s),10>n&&(n="0"+n);var r=s+"_"+n+"_"+l;fileSaveAs(new Blob([t],{type:"text/csv;charset=UTF-8"}),"Open Data Impact Map _ Data Export _ "+r+".csv")},render:function(){var e=this.props;o=[],r=[{columnName:"Company Name",visible:!0},{columnName:"Region",visible:!0},{columnName:"Country",visible:!0},{columnName:"Organization Type",visible:!0},{columnName:"Industry Category",visible:!0},{columnName:"Description",visible:!0,cssClassName:"description-column"},{columnName:"Data Use",visible:!0}];var a=["Company Name","Region","Country","Organization Type","Industry Category","Description","Data Use"];return _.forEach(e.keys,function(e){var a=e.attributes,t={"Company Name":a.org_name,Region:a.org_hq_country_region,Country:a.org_hq_country,"Organization Type":a.org_type,"Industry Category":a.industry_id,Description:a.org_description,"Data Use":a.dataCell,City:a.org_hq_city,"Founding Year":a.org_year_founded,Size:a.org_size_id,URL:a.org_url,profileID:a.profile_id,"Entry Based On":a.org_profile_category,use_advocacy:a.use_advocacy,use_advocacy_desc:a.use_advocacy_desc,use_prod_srvc:a.use_prod_srvc,use_prod_srvc_desc:a.use_prod_srvc_desc,use_org_opt:a.use_org_opt,use_org_opt_desc:a.use_org_opt_desc,use_research:a.use_research,use_research_desc:a.use_research_desc,use_other:a.use_other,use_other_desc:a.use_other_desc};o.push(t)}),React.createElement("div",{id:"results-ontainer",className:"results-container"},React.createElement("div",{id:"table-area",className:"table-area"},React.createElement(Griddle,{results:o,columnMetadata:r,columns:a,onRowClick:this.showPopup,enableInfiniteScroll:!1,resultsPerPage:9,useFixedHeader:!0,tableClassName:"table"}),React.createElement("div",{id:"popup-area",className:"table-company-popup"},React.createElement("span",{className:"close-popup",onClick:this.hidePopup},"X"),React.createElement("div",{id:"company-popup"}))))}});return n});