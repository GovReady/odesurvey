define(["table/TableController","widgets/CompanyPopup","react"],function(e,a,t){"use strict";var n=[],o=[],r={},l=React.createClass({displayName:"tableResults",showPopup:function(e,t){document.getElementById("popup-area").style.display="block",document.getElementById("popup-area").style.left=t.target.clientWidth+t.target.offsetLeft+"px",document.getElementById("popup-area").style.top=t.target.offsetTop+"px";var n=e.props.data;r.name=n["Company Name"],r.country=n.Country,r.profileID=n.profileID;var o=[{value:n.Country,label:"Country"},{value:n.City,label:"City"},{value:n["Founding Year"],label:"Founding Year"},{value:n.Size,label:"Size"},{value:n["Organization Type"],label:"Organization Type"},{value:n.Description,label:"Description"},{value:n["Industry Category"],label:"Category"},{value:n["Data Use"],label:"Data Use"},{value:n.URL,label:"URL"}];React.render(React.createElement(a,{keys:{profileID:{value:n.profileID},items:o,showContent:!0,title:{label:n["Company Name"],selected:!0,toggle:!1}}}),document.getElementById("company-popup"))},componentDidMount:function(){},hidePopup:function(e,a){document.getElementById("popup-area").style.display="none"},sendToEdit:function(){var e=r.profileID,a="http://odetest.govready.org/map/company/"+e+"/edit";window.open(a,"_blank")},exportTableDataJSON:function(){var e=JSON.stringify(n,null,4),a=new Date,t=a.getDate(),o=a.getMonth()+1,r=a.getFullYear();10>t&&(t="0"+t),10>o&&(o="0"+o);var a=t+"_"+o+"_"+r,l=new Blob([e],{type:"text/plain;charset=utf-8"});fileSaveAs(l,"Open Data Impact Map _ Data Export _ "+a+".txt")},exportTableData:function(){function e(e){for(var a=new ArrayBuffer(e.length),t=new Uint8Array(a),n=0;n!=e.length;++n)t[n]=255&e.charCodeAt(n);return a}var a={};a.Sheets={},a.Props={},a.SSF={},a.SheetNames=["Company Data"];var t={},o=[],r=[];o.push(Object.keys(n[0])),_.forEach(n,function(e){var a=[];_.forEach(o[0],function(t){a.push(e[t])}),o.push(a)});for(var l={s:{c:0,r:0},e:{c:0,r:0}},i=0;i!=o.length;++i){l.e.r<i&&(l.e.r=i);for(var p=0;p!=o[i].length;++p){l.e.c<p&&(l.e.c=p);var s={v:o[i][p]};if(null!=s.v){var u=XLSX.utils.encode_cell({c:p,r:i});s.t="number"==typeof s.v?"n":"boolean"==typeof s.v?"b":"s",t[u]=s}}}t["!ref"]=XLSX.utils.encode_range(l);for(var c=0;c<o[0].length;c++)r.push({wch:30});t["!cols"]=r,a.Sheets["Company Data"]=t;var y={bookType:"xlsx",bookSST:!1,type:"binary"},m=XLSX.write(a,y),d=new Date,g=d.getDate(),v=d.getMonth()+1,f=d.getFullYear();10>g&&(g="0"+g),10>v&&(v="0"+v);var d=g+"_"+v+"_"+f;fileSaveAs(new Blob([e(m)],{type:""}),"Open Data Impact Map _ Data Export _ "+d+".xlsx")},render:function(){var e=this.props;n=[],o=[{columnName:"Company Name",visible:!0},{columnName:"Region",visible:!0},{columnName:"Country",visible:!0},{columnName:"Organization Type",visible:!0},{columnName:"Industry Category",visible:!0},{columnName:"Description",visible:!0,cssClassName:"description-column"},{columnName:"Data Use",visible:!0}];var a=["Company Name","Region","Country","Organization Type","Industry Category","Description","Data Use"];return _.forEach(e.keys,function(e){var a=e.attributes,t={"Company Name":a.org_name,Region:a.org_hq_country_region,Country:a.org_hq_country,"Organization Type":a.org_type,"Industry Category":a.industry_id,Description:a.org_description,"Data Use":a.dataCell,City:a.org_hq_city,"Founding Year":a.org_year_founded,Size:a.org_size_id,URL:a.org_url,profileID:a.profile_id};n.push(t)}),React.createElement("div",{id:"results-ontainer",className:"results-container"},React.createElement("div",{id:"table-area",className:"table-area"},React.createElement(Griddle,{results:n,columnMetadata:o,columns:a,onRowClick:this.showPopup,enableInfiniteScroll:!1,resultsPerPage:8,useFixedHeader:!0,tableClassName:"table"}),React.createElement("div",{id:"popup-area",className:"table-company-popup"},React.createElement("span",{className:"close-popup",onClick:this.hidePopup},"X"),React.createElement("div",{id:"company-popup"}))))}});return l});