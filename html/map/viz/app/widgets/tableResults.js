define(["table/TableController","widgets/CompanyPopup","react"],function(e,a,t){"use strict";var o=[],r=[],n={},i=React.createClass({displayName:"tableResults",showPopup:function(e,t){document.getElementById("popup-area").style.display="block",document.getElementById("popup-area").style.left=t.target.clientWidth+t.target.offsetLeft+"px",document.getElementById("popup-area").style.top=t.target.offsetTop+"px";var o=e.props.data;n.name=o["Company Name"],n.country=o.Country,n.profileID=o.profileID;var r=[{value:o.Country,label:"Country"},{value:o.City,label:"City"},{value:o["Founding Year"],label:"Founding Year"},{value:o.Size,label:"Size"},{value:o["Organization Type"],label:"Organization Type"},{value:o.URL,label:"URL"},{value:o.Description,label:"Description"},{value:o["Industry Category"],label:"Category"},{value:o["Entry Based On"],label:"Entry Based On"},{value:o["Data Use"],label:"Data Use"}];"1"==o.use_advocacy&&r.push({label:"Application",value:"Advocacy: "+o.use_advocacy_desc}),"1"==o.use_prod_srvc&&r.push({label:"Application",value:"New Products and Services: "+o.use_prod_srvc_desc}),"1"==o.use_org_opt&&r.push({label:"Application",value:"Organizational Optimization: "+o.use_org_opt_desc}),"1"==o.use_research&&r.push({label:"Application",value:"Research: "+o.use_research_desc}),"1"==o.use_other&&r.push({label:"Application",value:"Other: "+o.use_other_desc}),React.render(React.createElement(a,{keys:{profileID:{value:o.profileID},items:r,showContent:!0,title:{label:o["Company Name"],selected:!0,toggle:!1}}}),document.getElementById("company-popup"))},componentDidMount:function(){},hidePopup:function(e,a){document.getElementById("popup-area").style.display="none"},sendToEdit:function(){var e=n.profileID,a="http://odetest.govready.org/map/company/"+e+"/edit";window.open(a,"_blank")},exportTableDataJSON:function(){var e=JSON.stringify(o,null,4),a=new Date,t=a.getDate(),r=a.getMonth()+1,n=a.getFullYear();10>t&&(t="0"+t),10>r&&(r="0"+r);var a=t+"_"+r+"_"+n,i=new Blob([e],{type:"text/plain;charset=utf-8"});fileSaveAs(i,"Open Data Impact Map _ Data Export _ "+a+".txt")},exportTableData:function(){var e=_.map(o,_.clone);delete e[0].profileID,delete e[0].use_advocacy,delete e[0].use_org_opt,delete e[0].use_other,delete e[0].use_prod_srvc,delete e[0].use_research;var a=[];a.push(Object.keys(e[0])),_.forEach(e,function(e){_.forEach(e,function(a,t){e[t]=String(e[t]).replace(/,/g," - "),e[t]=String(e[t]).replace(/(\r\n|\n|\r)/gm," ")}),a.push([e.Region,e.Country,e["Company Name"],e["Organization Type"],e["Industry Category"],e.Description,e.URL,e.City,e["State/Region"],e["Founding Year"],e.Size,e["Data Use"],e.Advocacy,e["Advocacy Description"],e["Product/Service"],e["Product/Service Description"],e["Organizational Optimization"],e["Organizational Optimization Description"],e.Research,e["Research Description"],e.Other,e["Use - Other Description"],e["Entry Based On"]]),_.forEach(a,function(e,t){_.forEach(e,function(e,o){"null"==e&&(a[t][o]=" ")})})});var t="";a.forEach(function(e,o){var r=e.join(",");t+=o<a.length?r+"\n":r});var r=new Date,n=r.getDate(),i=r.getMonth()+1,s=r.getFullYear();10>n&&(n="0"+n),10>i&&(i="0"+i);var r=n+"_"+i+"_"+s;fileSaveAs(new Blob([t],{type:"text/csv;charset=UTF-8"}),"Open Data Impact Map _ Data Export _ "+r+".csv")},render:function(){var e=this.props;o=[],r=[{columnName:"Company Name",visible:!0},{columnName:"Region",visible:!0},{columnName:"Country",visible:!0},{columnName:"Organization Type",visible:!0},{columnName:"Industry Category",visible:!0},{columnName:"Description",visible:!0,cssClassName:"description-column"},{columnName:"Data Use",visible:!0}];var a=["Company Name","Region","Country","Organization Type","Industry Category","Description","Data Use"];return _.forEach(e.keys,function(e){var a=e.attributes,t={Region:a.org_hq_country_region,Country:a.org_hq_country,"Company Name":a.org_name,"Organization Type":a.org_type,"Industry Category":a.industry_id,Description:a.org_description,URL:a.org_url,City:a.org_hq_city,"State/Region":a.org_hq_st_prov,"Founding Year":a.org_year_founded,Size:a.org_size_id,"Data Use":a.dataCell,Advocacy:a.use_advocacy,"Advocacy Description":a.use_advocacy_desc,"Product/Service":a.use_prod_srvc,"Product/Service Description":a.use_prod_srvc_desc,"Organizational Optimization":a.use_org_opt,"Organizational Optimization Description":a.use_org_opt_desc,Research:a.use_research,"Research Description":a.use_research_desc,Other:a.use_other,"Use - Other Description":a.use_other_desc,"Entry Based On":a.org_profile_category};o.push(t)}),React.createElement("div",{id:"results-ontainer",className:"results-container"},React.createElement("div",{id:"table-area",className:"table-area"},React.createElement(Griddle,{results:o,columnMetadata:r,columns:a,onRowClick:this.showPopup,enableInfiniteScroll:!1,resultsPerPage:9,useFixedHeader:!0,tableClassName:"table"}),React.createElement("div",{id:"popup-area",className:"table-company-popup"},React.createElement("span",{className:"close-popup",onClick:this.hidePopup},"X"),React.createElement("div",{id:"company-popup"}))))}});return i});