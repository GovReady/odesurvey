define(["table/TableController","widgets/CompanyPopup","react"],function(e,t,a){"use strict";var o=[],n=[],r={},l=React.createClass({displayName:"tableResults",showPopup:function(e,a){document.getElementById("popup-area").style.display="block",document.getElementById("popup-area").style.left=a.target.clientWidth+a.target.offsetLeft+"px",document.getElementById("popup-area").style.top=a.target.offsetTop+"px";var o=e.props.data;r.name=o["Company Name"],r.country=o.Country,r.profileID=o.profileID;var n=[{value:o.Country,label:"Country"},{value:o.City,label:"City"},{value:o["Founding Year"],label:"Founding Year"},{value:o.Size,label:"Size"},{value:o["Organization Type"],label:"Organization Type"},{value:o.Description,label:"Description"},{value:o["Industry Category"],label:"Category"},{value:o["Data Use"],label:"Data Use"},{value:o.URL,label:"URL"}];React.render(React.createElement(t,{keys:{profileID:{value:o.profileID},items:n,showContent:!0,title:{label:o["Company Name"],selected:!0,toggle:!1}}}),document.getElementById("company-popup"))},componentDidMount:function(){},hidePopup:function(e,t){document.getElementById("popup-area").style.display="none"},sendToEdit:function(){var e=r.profileID,t="http://odetest.govready.org/map/company/"+e+"/edit";window.open(t,"_blank")},exportTableData:function(){function e(e){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),o=0;o!=e.length;++o)a[o]=255&e.charCodeAt(o);return t}var t={};t.Sheets={},t.Props={},t.SSF={},t.SheetNames=["Company Data"];var a={},n=[],r=[];n.push(Object.keys(o[0])),_.forEach(o,function(e){var t=[];_.forEach(n[0],function(a){t.push(e[a])}),n.push(t)});for(var l={s:{c:0,r:0},e:{c:0,r:0}},i=0;i!=n.length;++i){l.e.r<i&&(l.e.r=i);for(var p=0;p!=n[i].length;++p){l.e.c<p&&(l.e.c=p);var s={v:n[i][p]};if(null!=s.v){var u=XLSX.utils.encode_cell({c:p,r:i});s.t="number"==typeof s.v?"n":"boolean"==typeof s.v?"b":"s",a[u]=s}}}a["!ref"]=XLSX.utils.encode_range(l);for(var c=0;c<n[0].length;c++)r.push({wch:30});a["!cols"]=r,t.Sheets["Company Data"]=a;var m={bookType:"xlsx",bookSST:!1,type:"binary"},y=XLSX.write(t,m),d=new Date,g=d.getDate(),v=d.getMonth()+1,b=d.getFullYear();10>g&&(g="0"+g),10>v&&(v="0"+v);var d=g+"_"+v+"_"+b;fileSaveAs(new Blob([e(y)],{type:""}),"CompanyExport_"+d+".xlsx")},render:function(){var e=this.props;o=[],n=[{columnName:"Company Name",visible:!0},{columnName:"Region",visible:!0},{columnName:"Country",visible:!0},{columnName:"Organization Type",visible:!0},{columnName:"Industry Category",visible:!0},{columnName:"Description",visible:!0,cssClassName:"description-column"},{columnName:"Data Use",visible:!0}];var t=["Company Name","Region","Country","Organization Type","Industry Category","Description","Data Use"];return _.forEach(e.keys,function(e){var t=e.attributes,a={"Company Name":t.org_name,Region:t.org_hq_city,Country:t.org_hq_country,"Organization Type":t.org_type,"Industry Category":t.industry_id,Description:t.org_description,"Data Use":t.data_type,City:t.org_hq_city,"Founding Year":t.org_year_founded,Size:t.org_size_id,URL:t.org_url,profileID:t.profile_id};o.push(a)}),React.createElement("div",{id:"results-ontainer",className:"results-container"},React.createElement("div",{id:"table-area",className:"table-area"},React.createElement(Griddle,{results:o,columnMetadata:n,columns:t,onRowClick:this.showPopup,enableInfiniteScroll:!1,resultsPerPage:8,useFixedHeader:!0,tableClassName:"table"}),React.createElement("div",{id:"popup-area",className:"table-company-popup"},React.createElement("span",{className:"close-popup",onClick:this.hidePopup},"X"),React.createElement("div",{id:"company-popup"}))),React.createElement("button",{id:"export-button",className:"export-button",onClick:this.exportTableData},"Export Table Data"))}});return l});