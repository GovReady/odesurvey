define(["map/MapController","map/map_config","main/config","main/Events","main/fetcher","widgets/baseMapGallery","widgets/switch","widgets/SelectableGroup","widgets/ToggleableGroup","widgets/LeftPanel","widgets/CenterPanel","widgets/StatisticsPane","dojo/Deferred","dojo/promise/all","leaflet","esrileaflet"],function(e,t,a,r,i,l,s,n,o,c,u,d,f,p){var m={};m.renderStatisticsPane=function(e){new d(e,"filterStats")};var b=function(){var l={id:"leftPanelComponent"};l.tabs={id:"tab-items",uiClass:"br-tab-items",outerContent:!0,idPrefix:"tabItem",items:a.panels,changed:r.selectPanelGroup},l.selectFilter=r.updateFilter,l.exportTableData=r.exportTableData,l.exportTableDataJSON=r.exportTableDataJSON,l.closePopups=r.closePopups,l.setSearchFilter=r.setSearchFilter,l.exportMap=r.exportMap,l.statisticsDiv="filterStats",l.accordian={items:t.filters,changed:r.selectFilterGroup,selected:!1};var s=t.filters.map(function(e){var a=new f;if(e.classNames=["filter-label"],e.source){e.items=[];var l=e.source.groupBy||[e.source.field],s=e.source.labelField||e.source.field,n=e.source.valueField||e.source.field,o=e.source.targetField||e.source.field;i.uniqueFields(e.source.url,n,"1=1",l).then(function(r){n!=o?i.uniqueFields(t.features,e.source.field,"1=1",[e.source.field]).then(function(t){var i=_.pluck(t,"org_hq_country_locode");r=_.filter(r,function(e){return e[n]&&_.contains(i,e[n])?!0:!1}),e.items=m.getFilterItems(n,s,o,r),a.resolve(!0)}):(e.items=m.getFilterItems(n,s,o,r),a.resolve(!0)),e.items=_.sortBy(e.items,"label")})}else e.items.forEach(function(e){e.changed=r.updateFilter,e.toggle=!0,e.classNames=["layer-radios","br-radio"]}),a.resolve(!0);return a});p(s).then(function(t){l.clearFilter=r.clearFilter,e.setMetaProps(l);new c(l,"leftPanel")})};return m.getFilterItems=function(e,t,a,r){return r=_.filter(r,function(e){return e[t]?!0:!1}),r.map(function(r){return{selected:!1,value:r[e],label:r[t],fieldName:a,classNames:["layer-radios","br-radio"],toggle:!0}})},m.initCenterPanelComponent=function(){var e={mapId:"mapDiv",tableId:"tableDiv"};e.tabs={id:"tab-items",uiClass:"br-tab-items",outerContent:!0,idPrefix:"tabItem",items:t.panels,changed:r.selectPanelGroup};new u(e,"centerPanel")},m.init=function(){b()},m});