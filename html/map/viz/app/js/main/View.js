define(["map/MapController","map/map_config","main/config","main/Events","main/fetcher","widgets/baseMapGallery","widgets/switch","widgets/SelectableGroup","widgets/ToggleableGroup","widgets/LeftPanel","widgets/CenterPanel","widgets/StatisticsPane","dojo/Deferred","dojo/promise/all","leaflet","esrileaflet"],function(e,t,a,i,r,l,s,n,o,c,u,d,f,m){var p={};p.renderStatisticsPane=function(e){new d(e,"filterStats")};var b=function(){var l={id:"leftPanelComponent"};l.tabs={id:"tab-items",uiClass:"br-tab-items",outerContent:!0,idPrefix:"tabItem",items:a.panels,changed:i.selectPanelGroup},l.selectFilter=i.updateFilter,l.exportTableData=i.exportTableData,l.exportTableDataJSON=i.exportTableDataJSON,l.closePopups=i.closePopups,l.setSearchFilter=i.setSearchFilter,l.exportMap=i.exportMap,l.statisticsDiv="filterStats",l.accordian={items:t.filters,changed:i.selectFilterGroup,selected:!1};var s=t.filters.map(function(e){var a=new f;if(e.classNames=["filter-label"],e.source){e.items=[];var l=e.source.groupBy||[e.source.field],s=e.source.labelField||e.source.field,n=e.source.valueField||e.source.field,o=e.source.targetField||e.source.field;r.uniqueFields(e.source.url,n,"1=1",l).then(function(i){n!=o?r.uniqueFields(t.features,e.source.field,"1=1",[e.source.field]).then(function(t){var r=_.pluck(t,"org_hq_country_locode");i=_.filter(i,function(e){return e[n]&&_.contains(r,e[n])?!0:!1}),e.items=p.getFilterItems(n,s,o,i),e.items=_.sortBy(e.items,"label"),a.resolve(!0)}):(e.items=p.getFilterItems(n,s,o,i),a.resolve(!0)),e.items=_.sortBy(e.items,"label")})}else e.items.forEach(function(e){e.changed=i.updateFilter,e.toggle=!0,e.classNames=["layer-radios","br-radio"]}),a.resolve(!0);return a});m(s).then(function(t){l.clearFilter=i.clearFilter,e.setMetaProps(l);new c(l,"leftPanel")})};return p.getFilterItems=function(e,t,a,i){return i=_.filter(i,function(e){return e[t]?!0:!1}),i.map(function(i){return{selected:!1,value:i[e],label:i[t],fieldName:a,classNames:["layer-radios","br-radio"],toggle:!0}})},p.initCenterPanelComponent=function(){var e={mapId:"mapDiv",tableId:"tableDiv"};e.tabs={id:"tab-items",uiClass:"br-tab-items",outerContent:!0,idPrefix:"tabItem",items:t.panels,changed:i.selectPanelGroup};new u(e,"centerPanel")},p.init=function(){b()},p});