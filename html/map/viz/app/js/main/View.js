define(["map/MapController","map/map_config","main/config","main/Events","main/fetcher","widgets/baseMapGallery","widgets/switch","widgets/SelectableGroup","widgets/ToggleableGroup","widgets/LeftPanel","widgets/CenterPanel","widgets/StatisticsPane","dojo/Deferred","dojo/promise/all","leaflet","esrileaflet"],function(e,t,i,r,a,l,s,n,o,c,u,d,f,m){var g={};g.renderStatisticsPane=function(e){new d(e,"filterStats")};var p=function(){var l={id:"leftPanelComponent"};l.tabs={id:"tab-items",uiClass:"br-tab-items",outerContent:!0,idPrefix:"tabItem",items:i.panels,changed:r.selectPanelGroup},l.selectFilter=r.updateFilter,l.statisticsDiv="filterStats",l.accordian={items:t.filters,changed:r.selectFilterGroup,selected:!1};var s=t.filters.map(function(e){var i=new f;if(e.classNames=["filter-label"],e.source){e.items=[];var l=e.source.groupBy||[e.source.field],s=e.source.labelField||e.source.field,n=e.source.valueField||e.source.field,o=e.source.targetField||e.source.field;a.uniqueFields(e.source.url,n,"1=1",l).then(function(r){n!=o?a.uniqueFields(t.features,e.source.field,"1=1",[e.source.field]).then(function(t){var a=_.pluck(t,"org_hq_country_locode");r=_.filter(r,function(e){return e[n]&&_.contains(a,e[n])?!0:!1}),e.items=g.getFilterItems(n,s,o,r),i.resolve(!0)}):(e.items=g.getFilterItems(n,s,o,r),i.resolve(!0)),e.items=_.sortBy(e.items,"label")})}else e.items.forEach(function(e){e.changed=r.updateFilter,e.toggle=!0,e.classNames=["layer-radios","br-radio"]}),i.resolve(!0);return i});m(s).then(function(t){l.clearFilter=r.clearFilter,e.setMetaProps(l);new c(l,"leftPanel")})};return g.getFilterItems=function(e,t,i,r){return r=_.filter(r,function(e){return e[t]?!0:!1}),r.map(function(r){return{selected:!1,value:r[e],label:r[t],fieldName:i,classNames:["layer-radios","br-radio"],toggle:!0}})},g.initCenterPanelComponent=function(){var e={mapId:"mapDiv",tableId:"tableDiv"};e.tabs={id:"tab-items",uiClass:"br-tab-items",outerContent:!0,idPrefix:"tabItem",items:t.panels,changed:r.selectPanelGroup};new u(e,"centerPanel")},g.init=function(){p()},g});