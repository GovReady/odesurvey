define(["dojo/Deferred","leaflet","esrileaflet"],function(e){var t={},r=L.esri.Tasks,n=r.query;return t.serviceInfo=function(t){var n=new e;return r.Task.request(t,{f:"json"},function(e){n.resolve(e)}),n},t.uniqueFields=function(t,r,n,u){var i=new e;return L.esri.get(t+"/query",{f:"json",outFields:[r],where:n||"1=1",outStatistics:[{statisticType:"count",onStatisticField:r,outStatisticFieldName:r+"count"}],groupByFieldsForStatistics:u.join(",")},function(e,t){if(e)i.resolve(e);else{var r=_.pluck(t.features,"attributes");i.resolve(r)}}),i},t.getQueryString=function(e){var t=e.map(function(e){var t=("number"===e.valueType?e.value:"'{}'".replace("{}",e.value),[e.fieldName,e.operator,e.value].join(" "));return t});return t.join(" AND ")},t.features=function(t,r){var u=new e,i=n({url:t});return _.keys(r).forEach(function(e){i[e](r[e])}),i.run(function(e,t,r){u.resolve(t)}),u},t});